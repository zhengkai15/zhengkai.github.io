<!DOCTYPE html>
<html lang="fr-FR">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
        <meta name="twitter:card" content="summary"/>
    



<meta name="twitter:title" content="LightGBM和XGBoost Custom Loss Function"/>
<meta name="twitter:description" content=""/>
<meta name="twitter:site" content="@vjeantet"/>



  	<meta property="og:title" content="LightGBM和XGBoost Custom Loss Function &middot; My blog is awesome" />
  	<meta property="og:site_name" content="My blog is awesome" />
  	<meta property="og:url" content="https://zhengkai15.github.io/zhengkai.github.io/post/selflossfunc/" />

    
        
            <meta property="og:image" content="/images/cover.jpg"/>
        
    

    
    <meta property="og:description" content="" />
  	<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2021-03-10T11:15:31&#43;08:00" />

    
    <meta property="article:tag" content="loss" />
    
    

    <title>LightGBM和XGBoost Custom Loss Function &middot; My blog is awesome</title>

    
    <meta name="description" content="&lt;p&gt;在LightGBM和XGBoost中的自定义损失函数（Custom Loss Function）。&lt;/p&gt;" />
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://zhengkai15.github.io/zhengkai.github.io/images/favicon.ico">
	  <link rel="apple-touch-icon" href="https://zhengkai15.github.io/zhengkai.github.io/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="https://zhengkai15.github.io/zhengkai.github.io/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="https://zhengkai15.github.io/zhengkai.github.io/css/nav.css" />

    

    

    
        <link href="http://feeds.feedburner.com/..." rel="alternate" type="application/rss+xml" title="My blog is awesome" />
    
    <meta name="generator" content="Hugo 0.81.0" />

    <link rel="canonical" href="https://zhengkai15.github.io/zhengkai.github.io/post/selflossfunc/" />

    
      
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name":  null ,
        "logo": "https://zhengkai15.github.io/zhengkai.github.io/images/logo.png"
    },
    "author": {
        "@type": "Person",
        "name":  null ,
        
        "image": {
            "@type": "ImageObject",
            "url": "https://zhengkai15.github.io/zhengkai.github.io/images/logo.png",
            "width": 250,
            "height": 250
        }, 
        
        "url": "http://vjeantet.fr",
        "sameAs": [
            
            
             
             
             
             
             
            
        ]
    },
    "headline": "LightGBM和XGBoost Custom Loss Function",
    "name": "LightGBM和XGBoost Custom Loss Function",
    "wordCount":  370 ,
    "timeRequired": "PT2M",
    "inLanguage": {
      "@type": "Language",
      "alternateName": "en"
    },
    "url": "https://zhengkai15.github.io/zhengkai.github.io/post/selflossfunc/",
    "datePublished": "2021-03-10T11:15Z",
    "dateModified": "2021-03-10T11:15Z",
    
    "keywords": "loss",
    "description": "",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://zhengkai15.github.io/zhengkai.github.io/post/selflossfunc/"
    }
}
    </script>
    


    

    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-79101-12', 'auto');
      ga('send', 'pageview');

    </script>
    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://zhengkai15.github.io/zhengkai.github.io/post/about/">About</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://zhengkai15.github.io/zhengkai.github.io/post/resume/">Resume</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://zhengkai15.github.io/zhengkai.github.io/post/links/">Links</a>
            </li>
        
        
    </ul>

    
    <a class="subscribe-button icon-feed" href="http://feeds.feedburner.com/...">Subscribe</a> </div>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">



<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
      <a class="blog-logo" href="https://zhengkai15.github.io/zhengkai.github.io/"><img src="https://zhengkai15.github.io/zhengkai.github.io/images/logo.png" alt="Home" /></a>
  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">LightGBM和XGBoost Custom Loss Function</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2021-03-10T11:15:31&#43;08:00">
            Mar 10, 2021
          </time>
        
         
          <span class="post-tag small"><a href="https://zhengkai15.github.io/zhengkai.github.io//tags/loss/">#loss</a></span>
         
        </section>
    </header>

    <section class="post-content">
      <p>在LightGBM和XGBoost中的自定义损失函数（Custom Loss Function）。</p>
<p>Training loss and Validation loss
Training loss: This is the function that is optimized on the training data. For example, in a neural network binary classifier, this is usually the binary cross entropy. For the random forest classifier, this is the Gini impurity. The training loss is often called the “objective function” as well. The training loss in LightGBM is called objective.</p>
<p>Validation loss: This is the function that we use to evaluate the performance of our trained model on unseen data. This is often not the same as the training loss. For example, in the case of a classifier, this is often the area under the curve of the receiver operating characteristic (ROC) — though this is never directly optimized, because it is not differentiable. This is often called the “performance or evaluation metric”. The validation loss is often used to tune hyper-parameters. It is often easier to customize, as it doesn’t have as many functional requirements like the training loss does. The validation loss can be non-convex, non-differentiable, and discontinuous. The validation loss in LightGBM is called metric.</p>
<p>我们可以用Validation loss做early stopping：当迭代次数（boosting rounds，树的数量）增加的时候，loss经过early_stopping_rounds不减小，则停止训练。</p>
<p>但是如果Validation loss function是二阶可导的，则可以考虑直接用其作为Training loss直接优化模型。</p>
<p>Training loss: Customizing the training loss in LightGBM requires defining a function that takes in two arrays, the targets and their predictions. In turn, the function should return two arrays of the gradient and hessian of each observation. As noted above, we need to use calculus to derive gradient and hessian and then implement it in Python.</p>
<p>Validation loss: Customizing the validation loss in LightGBM requires defining a function that takes in the same two arrays, but returns three values: a string with name of metric to print, the loss itself, and a boolean about whether higher is better.</p>
<p>官方例子-LGBM中自定义log likelihood loss：</p>
<h1 id="self-defined-objective-function">self-defined objective function</h1>
<h1 id="fpreds-array-train_data-dataset---grad-array-hess-array">f(preds: array, train_data: Dataset) -&gt; grad: array, hess: array</h1>
<h1 id="log-likelihood-loss">log likelihood loss</h1>
<p>def loglikelihood(preds, train_data):
labels = train_data.get_label()
preds = 1. / (1. + np.exp(-preds))
grad = preds - labels
hess = preds * (1. - preds)
return grad, hess</p>
<h1 id="self-defined-eval-metric">self-defined eval metric</h1>
<h1 id="fpreds-array-train_data-dataset---name-string-eval_result-float-is_higher_better-bool">f(preds: array, train_data: Dataset) -&gt; name: string, eval_result: float, is_higher_better: bool</h1>
<h1 id="binary-error">binary error</h1>
<p>def binary_error(preds, train_data):
labels = train_data.get_label()
return &lsquo;error&rsquo;, np.mean(labels != (preds &gt; 0.5)), False
实例
（1）自定义MSE
考虑这样一种场景，我们赶车赶飞机，预测我们的出发时间，使得我们等候时间最少。对于早到和晚到，惩罚是不一样的，早到机场火车站，无可厚非。但是要是晚到，就麻烦了… 所以显而易见，我们在建模时候需要加大迟到的惩罚。如下customMSE公式，对于迟到我们加大10倍的惩罚。</p>
    </section>


  <footer class="post-footer">


    








<figure class="author-image">
    <a class="img" href="https://zhengkai15.github.io/zhengkai.github.io/" style="background-image: url(/images/logo.png)"><span class="hidden">Kai Zheng's Picture</span></a>
</figure>


<section class="author">
  <h4><a href="https://zhengkai15.github.io/zhengkai.github.io/">Kai Zheng</a></h4>
  
  <p>Read <a href="https://zhengkai15.github.io/zhengkai.github.io/">more posts</a> by this author.</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Paris, France</span>
    <span class="author-link icon-link"><a href="http://vjeantet.fr">http://vjeantet.fr</a></span>
  </div>
</section>




    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=LightGBM%e5%92%8cXGBoost%20Custom%20Loss%20Function&nbsp;-&nbsp;My%20blog%20is%20awesome&amp;url=https%3a%2f%2fzhengkai15.github.io%2fzhengkai.github.io%2fpost%2fselflossfunc%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fzhengkai15.github.io%2fzhengkai.github.io%2fpost%2fselflossfunc%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fzhengkai15.github.io%2fzhengkai.github.io%2fpost%2fselflossfunc%2f&amp;description=LightGBM%e5%92%8cXGBoost%20Custom%20Loss%20Function"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=https%3a%2f%2fzhengkai15.github.io%2fzhengkai.github.io%2fpost%2fselflossfunc%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    

<div id="disqus_thread"></div>
<script>




var disqus_config = function () {
this.page.url = "https:\/\/zhengkai15.github.io\/zhengkai.github.io\/post\/selflossfunc\/";  
this.page.identifier = "https:\/\/zhengkai15.github.io\/zhengkai.github.io\/post\/selflossfunc\/"; 
};

(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://YOUR_SHORT_NAME_HERE.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>








  </footer>
</article>

</main>


  <aside class="read-next">
  
      <a class="read-next-story" style="no-cover" href="https://zhengkai15.github.io/zhengkai.github.io/post/tensorflow_install/">
          <section class="post">
              <h2>Install</h2>
              
          </section>
      </a>
  
  
      <a class="read-next-story prev" style="no-cover" href="https://zhengkai15.github.io/zhengkai.github.io/post/macprobrome/">
          <section class="post">
              <h2>升级后的系统是macOS 10.15 (Catalina) ，安装cartopy</h2>
          </section>
      </a>
  
</aside>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">My blog is awesome</a> All rights reserved - 2015</section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="https://zhengkai15.github.io/zhengkai.github.io/js/jquery.js"></script>
    <script type="text/javascript" src="https://zhengkai15.github.io/zhengkai.github.io/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://zhengkai15.github.io/zhengkai.github.io/js/index.js"></script>
    
</body>
</html>

